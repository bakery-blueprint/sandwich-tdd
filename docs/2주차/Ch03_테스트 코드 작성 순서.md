# Chapter 3. 테스트 코드 작성 순서

## 1. 테스트 코드 작성 순서

### 테스트 코드 순서 규칙은
1) 쉬운 경우에서 어려운 경우로 진행
2) 예외적인 경우에서 정상적인 경우로 진행

### 쉬운 테스트부터 진행해야 하는 이유
 - (당연하게도) 초반부터 어려운 테스트로 시작하면, 
   초반에 모든 경우의 수를 충족시켜야 하는 경우가 발생하므로 쉬운 경우부터 진행해야 함.

### 예외 상황을 먼저 테스트해야 하는 이유
 - 예외를 고려하지 않은 케이스 테스트 후 예외를 넣으려면 코드의 구조를 뒤집거나
   중간에 조건문을 넣어야 하는 경우가 많아지므로 버그 발생 가능성을 높임.
   초반에 if-else 로 예외가 구현되어야 테스트가 진행되더라도 코드 구조가 덜 바뀜.

### 완급 조절
 1) 정해진 값을 리턴
 2) 값 비교를 이용해서 정해진 값을 리턴
 3) 다양한 테스트를 추가하면서 구현을 일반화

### 지속적인 리팩토링
 - 상수를 변수로 바꾸거나 변수이름을 변경하는 것과 같은 작은 리팩토링은 발견 즉시 진행.
 - 메서드 추출과 같이 메서드의 구조에 영향을 주는 리팩토링은 큰 틀에서 구현의 흐름이 눈에 들어오기 시작한 뒤에 진행.


### * 테스트 작성 순서 연습
 - 매달 비용을 지불해야 하는 유료 서비스의 서비스 만료일 결정 규칙
   a. 서비스를 사용하려면 매달 1만원을 선불로 납부. 납부일 기준으로 한 달 뒤가 서비스 만료일이 됨.
   b. 2개월 이상 요금을 납부할 수 있음.
   c. 10만원을 납부하면 서비스를 1년 제공함.


 1)	쉬운 것부터 테스트
  - 구현하기 쉬운 것부터 먼저 테스트
  - 예외 상황을 먼저 테스트

 2) 예를 추가하면서 구현을 일반화
  
 3) 코드 정리 : 중복 제거 (리팩토링)

 4) 예외 상황 처리

 5) 다음 테스트 선택 : 다시 예외 상황

 6) 다음 테스트 추가하기 전에 리팩토링

  - 리팩토링 과정 : 

 7) 예외 상황 테스트 진행 계속

 8) 코드 정리 : 상수를 변수로

 9) 다음 테스트 선택 : 쉬운 테스트

 10) 예외 상황 테스트 추가

 11) 코드 정리

 12) 다음 테스트 : 10개월 요금을 납부하면 1년 제공



## 2. 테스트할 목록 정리하기

### ex) 만료일 계산 기능 구현시 
 - 1만원 납부하면 한 달 뒤가 만료일
 - 달의 마지막 날에 납부하면 다음달 마지막 날이 만료일
 - 2만원 납부하면 2개월 뒤가 만료일
 - 3만원 납부하면 3개월 뒤가 만료일
 - 10만원 납부하면 1년 뒤가 만료일

 * 테스트 과정에서 새로운 테스트 케이스 발견시 목록에 즉시 추가.
 * 리팩토링이 너무 거대하면 진행하지 말고, 테스트 통과에 집중.
 * 하나의 싸이클 완성시 거대한 리팩토링 진행하되, 커밋이나 내용 복사 해둘 것.



## 3. 시작이 안될 때는 단언부터 고민

assertEquals(기대하는 만료일, 실제 만료일);
부터 시작하여 거꾸로 메서드 작성해나감.

4. 구현이 막히면
 다음을 상기.
 - 쉬운 테스트, 예외적인 테스트
 - 완급 조절